#if 0
	shc Version 3.8.9b, Generic Script Compiler
	Copyright (c) 1994-2015 Francisco Rosales <frosal@fi.upm.es>

	./shc -rT -f scan.sh 
#endif

static  char data [] = 
#define      msg1_z	42
#define      msg1	((&data[5]))
	"\374\226\253\176\062\023\114\154\066\233\144\144\160\105\221\350"
	"\254\220\165\015\005\302\222\112\377\050\061\164\327\307\105\355"
	"\011\316\377\064\246\135\330\210\330\015\124\114\062\241\035\251"
#define      chk2_z	19
#define      chk2	((&data[50]))
	"\347\205\305\317\161\035\044\273\046\140\165\102\173\257\076\136"
	"\061\047\105\210\245\225\245"
#define      lsto_z	1
#define      lsto	((&data[71]))
	"\062"
#define      pswd_z	256
#define      pswd	((&data[72]))
	"\323\121\157\063\361\137\074\104\302\372\051\316\153\162\350\253"
	"\265\032\331\200\233\245\275\223\012\106\073\247\314\226\365\240"
	"\350\144\323\332\303\020\037\206\012\110\124\166\272\074\042\160"
	"\127\373\361\362\241\256\205\254\364\300\123\301\127\110\142\100"
	"\255\066\033\161\106\072\367\121\202\113\307\075\207\352\255\337"
	"\346\236\321\207\115\127\063\102\030\207\004\160\320\146\261\175"
	"\234\314\356\343\006\346\064\211\061\374\306\271\346\164\231\314"
	"\023\153\124\140\302\210\242\333\017\246\113\340\015\375\135\251"
	"\311\114\215\320\062\301\131\144\276\040\036\245\224\267\162\247"
	"\042\306\010\345\116\252\300\136\121\014\076\136\011\234\010\323"
	"\351\226\244\034\130\376\200\026\036\236\273\263\126\056\133\170"
	"\364\143\136\103\016\036\242\140\053\341\277\065\175\307\011\147"
	"\136\255\203\266\254\003\314\313\242\210\176\371\266\331\162\253"
	"\075\320\357\113\357\222\253\032\163\152\120\361\062\131\130\220"
	"\007\334\107\263\337\023\176\202\234\375\173\123\327\355\377\024"
	"\275\357\140\255\201\014\307\365\167\027\347\252\161\100\073\170"
	"\353\172\062\323\044\243"
#define      date_z	1
#define      date	((&data[334]))
	"\220"
#define      shll_z	8
#define      shll	((&data[337]))
	"\054\170\357\233\055\131\375\064\154\374"
#define      inlo_z	3
#define      inlo	((&data[345]))
	"\154\154\104"
#define      msg2_z	19
#define      msg2	((&data[351]))
	"\036\215\266\216\123\174\276\052\373\375\270\134\043\220\073\051"
	"\236\314\133\072\270\131"
#define      rlax_z	1
#define      rlax	((&data[370]))
	"\221"
#define      opts_z	1
#define      opts	((&data[371]))
	"\150"
#define      text_z	1584
#define      text	((&data[620]))
	"\046\322\337\113\166\362\253\223\042\215\334\116\005\321\371\260"
	"\156\237\341\215\054\230\100\136\302\352\344\343\226\204\357\275"
	"\126\316\010\315\300\263\140\343\101\074\061\106\016\053\367\175"
	"\313\331\012\367\162\113\126\064\065\072\027\314\276\007\212\025"
	"\325\222\342\225\106\103\170\207\200\252\316\216\326\306\013\241"
	"\240\026\230\022\141\357\106\226\051\136\143\350\145\355\375\073"
	"\200\340\320\306\044\111\115\244\364\034\063\313\342\077\155\202"
	"\125\006\224\266\365\333\115\036\072\260\007\240\236\005\333\037"
	"\345\254\345\012\366\063\256\353\117\342\266\062\041\043\264\166"
	"\052\111\054\037\045\172\076\137\053\105\000\311\112\333\350\060"
	"\210\316\072\176\002\351\151\121\314\040\204\355\104\071\144\156"
	"\202\220\216\250\013\315\010\066\022\010\377\135\344\350\216\154"
	"\267\311\353\271\262\125\013\177\165\217\154\272\310\320\050\113"
	"\141\267\363\154\204\373\242\227\004\242\364\351\213\202\126\102"
	"\114\101\373\376\227\006\176\014\226\352\307\136\273\360\252\035"
	"\247\235\212\053\231\054\302\235\217\276\017\324\241\066\372\157"
	"\332\032\131\217\165\264\111\324\013\221\201\110\025\076\130\335"
	"\051\307\261\174\361\152\335\055\007\350\072\263\274\000\122\013"
	"\222\147\352\024\155\327\350\102\161\071\160\276\374\212\213\112"
	"\305\224\201\237\057\057\074\360\175\367\265\010\206\333\211\004"
	"\276\161\044\203\013\254\034\156\353\220\004\033\363\250\103\032"
	"\106\131\071\147\373\043\222\057\031\043\352\027\131\163\065\172"
	"\034\323\100\215\116\112\306\150\340\327\033\337\251\307\163\121"
	"\147\317\176\143\132\336\077\117\110\222\072\312\355\233\302\112"
	"\123\217\332\254\115\157\342\142\011\066\032\056\003\031\313\022"
	"\160\012\144\014\040\143\052\317\110\034\221\071\332\076\161\055"
	"\262\116\175\221\375\175\325\257\146\070\075\002\206\123\271\310"
	"\037\055\014\006\202\011\201\202\152\141\117\355\116\307\226\064"
	"\215\271\165\226\167\342\374\237\141\275\227\050\204\172\066\216"
	"\362\323\106\203\350\303\031\011\143\124\152\270\061\032\062\072"
	"\273\346\257\123\234\244\237\262\311\250\202\051\345\104\362\145"
	"\216\331\123\100\323\045\271\314\251\044\066\365\364\306\122\224"
	"\161\145\241\016\037\054\121\305\322\321\231\174\343\167\010\351"
	"\062\145\017\075\337\315\075\315\352\175\353\332\113\011\071\065"
	"\104\017\127\061\273\135\127\106\230\004\137\244\131\336\175\161"
	"\255\107\144\143\267\173\334\260\146\147\175\332\267\003\220\176"
	"\354\360\240\042\051\032\056\047\347\321\077\106\240\200\220\251"
	"\244\066\123\255\135\232\300\245\036\002\377\046\265\352\215\243"
	"\153\145\163\224\146\244\332\222\134\315\100\246\322\176\074\335"
	"\127\107\222\321\141\275\166\146\335\236\004\300\104\071\300\177"
	"\341\363\052\131\240\027\023\376\021\147\116\066\017\366\340\213"
	"\006\057\325\027\024\311\140\162\013\123\271\371\010\120\241\263"
	"\164\044\036\357\017\035\171\205\012\134\310\112\377\263\161\121"
	"\132\357\306\022\267\046\273\140\243\016\267\324\140\060\115\134"
	"\304\242\055\074\160\141\324\056\342\061\153\225\141\066\047\150"
	"\170\215\043\235\046\361\313\063\172\114\341\200\330\026\305\054"
	"\057\330\055\143\040\106\033\133\175\040\371\270\125\106\355\064"
	"\152\305\360\160\037\230\150\316\010\161\120\305\200\342\076\040"
	"\127\261\062\042\344\217\231\166\042\340\073\015\177\250\121\073"
	"\140\210\316\126\110\016\002\377\045\334\325\111\030\357\301\046"
	"\216\012\101\210\335\246\000\320\000\312\226\310\221\355\341\204"
	"\130\343\044\347\204\124\165\335\161\233\053\103\004\217\332\110"
	"\154\210\272\206\350\232\126\250\266\036\343\040\302\006\374\373"
	"\203\251\122\042\301\042\342\306\140\073\035\364\311\066\260\164"
	"\204\236\002\150\252\000\106\044\131\100\360\243\113\377\102\053"
	"\320\115\321\004\237\237\223\016\355\201\327\232\132\322\047\103"
	"\336\127\153\104\062\261\003\000\160\134\372\321\023\162\015\121"
	"\327\365\276\126\047\244\317\270\134\320\070\113\026\277\044\025"
	"\200\334\015\352\323\304\344\300\073\115\370\206\011\042\124\052"
	"\100\262\013\257\204\335\204\275\247\047\363\066\131\212\212\333"
	"\246\031\212\103\335\361\142\200\261\035\063\323\134\026\147\222"
	"\355\036\276\344\167\030\205\046\315\061\363\336\236\345\251\354"
	"\152\006\350\305\103\006\002\051\273\147\101\161\354\040\266\055"
	"\305\133\321\377\167\206\270\200\311\050\262\331\260\243\033\023"
	"\126\010\323\161\235\070\325\055\005\275\146\105\220\075\142\102"
	"\026\053\044\130\103\340\251\321\340\147\373\331\120\054\000\342"
	"\030\166\251\001\356\022\015\313\020\365\040\360\042\112\157\044"
	"\061\121\047\230\046\356\071\313\142\117\202\335\064\210\011\064"
	"\111\334\126\121\011\243\212\107\124\251\230\062\062\211\215\023"
	"\047\345\317\146\054\076\106\301\101\310\012\021\103\276\166\252"
	"\013\014\000\244\211\354\270\250\165\370\147\224\246\230\033\145"
	"\221\117\324\333\234\225\107\066\041\307\277\233\111\142\115\161"
	"\370\060\145\076\147\113\247\355\357\140\361\067\363\253\232\330"
	"\237\353\363\356\112\217\306\101\374\115\036\250\253\043\154\235"
	"\356\015\355\014\014\047\173\066\331\161\366\001\115\222\365\055"
	"\226\002\262\261\177\341\344\110\162\037\172\355\070\040\206\073"
	"\225\251\215\253\221\071\057\255\332\305\177\260\363\064\361\266"
	"\315\216\056\215\363\004\142\302\313\202\166\057\027\261\225\222"
	"\335\247\341\233\133\155\367\204\071\376\172\370\215\265\340\063"
	"\004\166\335\061\327\247\342\332\174\277\200\167\361\325\036\337"
	"\001\201\252\012\132\255\033\112\306\117\231\071\067\320\141\103"
	"\262\271\036\354\007\367\021\246\105\246\147\004\112\114\047\147"
	"\041\332\314\012\002\264\321\202\132\225\075\042\374\352\350\033"
	"\027\372\001\025\325\214\114\324\052\044\264\144\034\373\046\054"
	"\110\347\132\060\110\333\370\221\254\241\242\367\165\133\277\147"
	"\313\264\276\027\156\226\070\070\233\174\274\362\354\140\164\173"
	"\365\014\370\275\210\055\007\135\250\107\351\314\117\103\004\360"
	"\107\331\273\370\027\053\124\362\247\045\154\075\057\001\343\153"
	"\067\121\275\052\345\144\177\013\126\114\261\342\011\063\332\170"
	"\004\357\373\322\125\264\326\167\167\323\102\273\204\133\256\363"
	"\327\225\156\057\011\165\277\253\344\302\172\342\006\343\145\021"
	"\305\336\204\360\073\277\022\356\204\116\343\246\366\111\076\054"
	"\362\054\024\277\174\112\065\100\230\004\151\153\163\242\232\166"
	"\310\350\012\046\170\112\011\220\370\157\271\112\141\265\373\112"
	"\314\320\303\245\361\375\003\134\311\255\161\327\334\063\135\324"
	"\333\031\056\216\245\027\126\102\264\034\201\101\232\305\267\153"
	"\167\115\021\005\054\037\143\374\215\153\320\301\331\365\310\110"
	"\232\136\377\035\252\270\302\335\256\121\345\137\151\046\360\001"
	"\172\255\155\112\122\345\073\121\151\120\270\142\331\000\046\132"
	"\357\255\207\217\352\135\262\263\125\160\276\004\146\167\173\367"
	"\051\346\347\046\147\222\107\052\047\024\230\113\133\167\332\345"
	"\215\376\313\221\231\001\021\177\161\014\043\244\061\151\350\241"
	"\026\220\160\333\051\164\136\343\303\233\304\156\344\153\072\205"
	"\210\047\352\004\374\207\345\374\072\310\036\030\217\272\006\172"
	"\175\100\223\360\341\223\344\165\166\221\022\337\266\143\167\061"
	"\204\336\177\163\322\061\206\127\335\177\151\345\133\005\353\064"
	"\121\103\160\254\346\373\277\316\273\177\344\150\105\312\154\041"
	"\037\252\112\147\344\056\003\237\377\145\253\337\232\132\222\347"
	"\157\013\110\247\356\314\122\001\370\166\355\224\170\007\040\123"
	"\230\333\144\015\353\074\125\111\306\220\120\277\367\225\354\204"
	"\256\376\011\234\004\137\355\055\131\020\271\321\167\021\212\020"
	"\202\347\017\170\001\207\136\367\007\256\174\152\012\035\117\145"
	"\037\143\301\147\222\373\153\034\313\063\326\013\223\101\210\156"
	"\127\075\371\043\237\350\366\024\054\052\250\216\126\240\104\366"
	"\222\263\012\103\163\055\222\230\317\267\207\132\072\335\234\206"
	"\036\230\205\266\236\003\302\064\356\212"
#define      chk1_z	22
#define      chk1	((&data[2225]))
	"\075\307\041\207\034\162\055\322\275\007\174\224\017\033\126\336"
	"\151\022\044\073\000\256\065\240\077\333\121"
#define      xecc_z	15
#define      xecc	((&data[2250]))
	"\020\356\062\142\220\002\316\117\245\227\325\017\113\272\134\201"
	"\022"
#define      tst1_z	22
#define      tst1	((&data[2270]))
	"\250\002\166\105\166\245\152\356\236\356\321\362\124\042\105\017"
	"\362\075\221\033\121\124\242\156\237\240\211\225\335"
#define      tst2_z	19
#define      tst2	((&data[2296]))
	"\022\351\147\366\217\000\373\234\061\022\206\007\006\235\027\177"
	"\026\230\332\202\016\260"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
